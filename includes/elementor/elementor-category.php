<?php

/**
 * Custom Elementor Category Registration
 * This ensures the category appears at the correct position
 */

if (!defined('ABSPATH')) {
    exit; // Exit if accessed directly
}

class Plugincy_Elementor_Category_Alternative
{

    public function __construct()
    {
        add_action('elementor/init', [$this, 'init_category'], 1);
        // Add styles
        add_action('elementor/editor/after_enqueue_styles', [$this, 'add_category_styles']);
    }

    private function get_svg_icon()
    {
        return '<svg style="transform: scale(0.35) translate(-100%, 0px);" xmlns="http://www.w3.org/2000/svg" version="1.1" width="207" height="50">
<path d="M0 0 C0.33 -0.33 0.66 -0.66 1 -1 C3.33297433 -1.04092937 5.66705225 -1.04241723 8 -1 C8.09957372 3.00171468 8.17179608 7.00294042 8.21972656 11.00561523 C8.23972628 12.36446713 8.26693576 13.72323424 8.30175781 15.08178711 C8.65605901 29.26946584 8.65605901 29.26946584 4 35 C-1.15614434 38.13412695 -6.10477372 38.80813295 -12 38 C-14.51215626 37.19795378 -16.63890387 36.20566611 -19 35 C-18.34 33.35 -17.68 31.7 -17 30 C-16.19175781 30.13019531 -15.38351563 30.26039062 -14.55078125 30.39453125 C-13.48214844 30.53246094 -12.41351563 30.67039063 -11.3125 30.8125 C-10.25675781 30.96332031 -9.20101562 31.11414062 -8.11328125 31.26953125 C-4.84927194 31.24627046 -4.84927194 31.24627046 -2.1328125 29.015625 C0.52325673 25.26015714 0.64446892 22.36501154 0.4375 17.9375 C0.43169922 17.23044922 0.42589844 16.52339844 0.41992188 15.79492188 C0.33327431 12.10373571 0.15303161 9.07247571 -2 6 C-4.77100394 4.61449803 -6.9334706 4.8122533 -10 5 C-13.42573253 6.77789851 -13.42573253 6.77789851 -13.8125 10.875 C-14.10896376 14.14203063 -14.05640468 16.29420437 -12 19 C-9.2201184 20.3899408 -7.0813674 20.18488204 -4 20 C-1.69769234 19.10168984 -1.69769234 19.10168984 0 18 C0 20.31 0 22.62 0 25 C-4.14327024 27.0088583 -7.41538356 27.40215934 -12 27 C-16.15757553 25.40093249 -18.7122114 23.85311765 -21 20 C-22.74905779 14.75282664 -22.66979417 9.80844425 -20.75 4.625 C-15.80556745 -2.79164883 -7.84641688 -3.80432334 0 0 Z " fill="#4A4AF2" transform="translate(94,12)"></path>
<path d="M0 0 C5.01319327 -0.35666988 8.85303903 -0.56305357 13.4375 1.6875 C16.79656012 4.71884694 18.69355631 6.74139648 19.31640625 11.33203125 C19.516262 15.63215344 19.23685904 18.47891012 17.4375 22.4375 C13.52850999 26.54695104 9.86483071 27.87567795 4.25 28.25 C1 28 1 28 -2 27 C-2 30.96 -2 34.92 -2 39 C-4.31 39 -6.62 39 -9 39 C-9 29.1 -9 19.2 -9 9 C-6.69 9 -4.38 9 -2 9 C-1.9071875 10.8871875 -1.9071875 10.8871875 -1.8125 12.8125 C-1.39881602 16.04727886 -1.24607288 16.76095777 1.1875 19.125 C4.79840386 20.24839231 6.6009248 19.50191695 10 18 C10.33 15.69 10.66 13.38 11 11 C7.57653445 7.85041169 4.55737263 7.43820891 0 7 C0 4.69 0 2.38 0 0 Z " fill="#3056EF" transform="translate(9,11)"></path>
<path d="M0 0 C2.64 0 5.28 0 8 0 C10.64 5.61 13.28 11.22 16 17 C18.26126142 11.78054022 18.26126142 11.78054022 20.51733398 6.55883789 C22.88888889 1.11111111 22.88888889 1.11111111 24 0 C26.33297433 -0.04092937 28.66705225 -0.04241723 31 0 C30.42380154 4.63050862 29.15060152 8.28698694 27.1640625 12.5 C26.88404388 13.09876953 26.60402527 13.69753906 26.31552124 14.31445312 C25.42556395 16.21296268 24.52541178 18.10643016 23.625 20 C23.02798404 21.27052257 22.43162393 22.54135354 21.8359375 23.8125 C19.28579164 29.24017112 16.69736373 34.64359024 14 40 C11.36 40 8.72 40 6 40 C6.38414062 39.20335937 6.76828125 38.40671875 7.1640625 37.5859375 C7.64617187 36.52632812 8.12828125 35.46671875 8.625 34.375 C9.11226562 33.33085938 9.59953125 32.28671875 10.1015625 31.2109375 C11.2360046 27.15654007 10.69908412 25.83217341 9 22 C8.66403809 21.23671387 8.32807617 20.47342773 7.98193359 19.68701172 C6.38982936 16.10596431 4.74447367 12.55014849 3.1015625 8.9921875 C2.70453125 8.12335937 2.3075 7.25453125 1.8984375 6.359375 C1.53411621 5.57014648 1.16979492 4.78091797 0.79443359 3.96777344 C0 2 0 2 0 0 Z " fill="#AC20FD" transform="translate(176,10)"></path>
<path d="M0 0 C3.21819007 1.63945532 5.35142057 2.86444005 7.16015625 6.03125 C8.36981809 10.30726395 8.21066843 14.39398581 8.125 18.8125 C8.11597656 19.69615234 8.10695312 20.57980469 8.09765625 21.49023438 C8.07419637 23.66027359 8.03832865 25.83017247 8 28 C5.69 28 3.38 28 1 28 C0.96261719 26.90300781 0.92523438 25.80601563 0.88671875 24.67578125 C0.82103347 23.22132143 0.75458701 21.76689584 0.6875 20.3125 C0.66494141 19.59126953 0.64238281 18.87003906 0.61914062 18.12695312 C0.39321663 13.62901178 -0.24937312 10.73878775 -3 7 C-6.43230448 7.26393501 -6.43230448 7.26393501 -10 8 C-11.9756562 10.96348429 -12.26376859 11.68020373 -12.4140625 15.01171875 C-12.45273438 15.76904297 -12.49140625 16.52636719 -12.53125 17.30664062 C-12.5621875 18.09232422 -12.593125 18.87800781 -12.625 19.6875 C-12.66367188 20.48478516 -12.70234375 21.28207031 -12.7421875 22.10351562 C-12.83632494 24.06863475 -12.91924632 26.0342854 -13 28 C-15.31 28 -17.62 28 -20 28 C-20 19.09 -20 10.18 -20 1 C-16.66666667 1 -13.33333333 1 -10 1 C-6.38069302 -0.20643566 -3.80768995 -0.32268559 0 0 Z " fill="#6F3AF6" transform="translate(139,10)"></path>
<path d="M0 0 C2.31 0 4.62 0 7 0 C7.04898438 1.02480469 7.09796875 2.04960937 7.1484375 3.10546875 C7.22351071 4.4661706 7.29905655 5.82684644 7.375 7.1875 C7.4059375 7.86103516 7.436875 8.53457031 7.46875 9.22851562 C7.80882378 15.63459562 7.80882378 15.63459562 11 21 C14.48055874 20.82432642 14.48055874 20.82432642 18 20 C19.9756562 17.03651571 20.26376859 16.31979627 20.4140625 12.98828125 C20.45273437 12.23095703 20.49140625 11.47363281 20.53125 10.69335938 C20.57765625 9.51483398 20.57765625 9.51483398 20.625 8.3125 C20.66367187 7.51521484 20.70234375 6.71792969 20.7421875 5.89648438 C20.83632494 3.93136525 20.91924632 1.9657146 21 0 C23.31 0 25.62 0 28 0 C28 8.91 28 17.82 28 27 C24.66666667 27 21.33333333 27 18 27 C16.56220501 27.22730854 15.12473055 27.4566495 13.6875 27.6875 C9.25285198 28.17062426 6.65897114 27.78778754 3 25 C-0.04800426 19.40118366 -0.38535317 14.85828932 -0.1875 8.5625 C-0.17396484 7.73556641 -0.16042969 6.90863281 -0.14648438 6.05664062 C-0.11146992 4.0374736 -0.05767562 2.01864682 0 0 Z " fill="#3653F0" transform="translate(43,11)"></path>
<path d="M0 0 C2.59892058 1.77487259 3.550168 2.81423721 4.5625 5.75 C3.2425 6.74 1.9225 7.73 0.5625 8.75 C0.005625 8.440625 -0.55125 8.13125 -1.125 7.8125 C-4.72303299 6.15934971 -7.23060838 5.44126028 -11.125 6.4375 C-13.85517393 7.98705818 -14.60011583 8.73541699 -15.4375 11.75 C-15.36207659 14.86993606 -15.36207659 14.86993606 -14.4375 17.75 C-10.72174249 20.22717167 -8.83763262 20.05345742 -4.4375 19.75 C-3.550625 19.358125 -2.66375 18.96625 -1.75 18.5625 C-0.986875 18.294375 -0.22375 18.02625 0.5625 17.75 C2.875 19.125 2.875 19.125 4.5625 20.75 C3.550168 23.68576279 2.59892058 24.72512741 0 26.5 C-5.5302254 28.51099106 -10.20643741 28.54981489 -15.75 26.5625 C-20.2497844 23.52776169 -22.10439604 21.2251747 -23.3125 15.875 C-23.61381118 11.77253239 -23.09290594 8.56463108 -21.4375 4.75 C-15.55218644 -1.75747528 -8.04847983 -2.92671994 0 0 Z " fill="#8B2EFA" transform="translate(171.4375,11.25)"></path>
<path d="M0 0 C2.31 0 4.62 0 7 0 C7 12.54 7 25.08 7 38 C4.69 38 2.38 38 0 38 C0 25.46 0 12.92 0 0 Z " fill="#2A58EF" transform="translate(31,0)"></path>
<path d="M0 0 C5.01319327 -0.35666988 8.85303903 -0.56305357 13.4375 1.6875 C16.79656012 4.71884694 18.69355631 6.74139648 19.31640625 11.33203125 C19.58141295 17.0339496 18.95285684 20.59538809 15 25 C14.01 25.33 13.02 25.66 12 26 C12.020625 25.0925 12.04125 24.185 12.0625 23.25 C12.01003572 20.52185754 11.66873735 18.59135723 11 16 C11.0928125 14.7315625 11.0928125 14.7315625 11.1875 13.4375 C11.24137938 10.91407737 11.24137938 10.91407737 9.4375 9.25 C6.32386342 7.65326329 3.46114647 7.33280254 0 7 C0 4.69 0 2.38 0 0 Z " fill="#14A9F9" transform="translate(9,11)"></path>
<path d="M0 0 C2.64 0 5.28 0 8 0 C8 8.91 8 17.82 8 27 C5.36 27 2.72 27 0 27 C0 18.09 0 9.18 0 0 Z " fill="#5A44F4" transform="translate(105,11)"></path>
<path d="M0 0 C1.62490954 -0.02698189 3.24994633 -0.04638757 4.875 -0.0625 C5.77992187 -0.07410156 6.68484375 -0.08570313 7.6171875 -0.09765625 C10 0 10 0 12 1 C12 3.64 12 6.28 12 9 C9.20215289 9 7.0209322 8.62804225 4.3125 8 C3.10013672 7.7215625 3.10013672 7.7215625 1.86328125 7.4375 C0.94095703 7.2209375 0.94095703 7.2209375 0 7 C0 4.69 0 2.38 0 0 Z " fill="#6A3DF6" transform="translate(9,11)"></path>
<path d="M0 0 C3.61424938 3.61424938 4.16151733 4.89433851 4.25 9.8125 C4.21964431 14.00765577 3.76975204 16.67629755 1 20 C0.67 20 0.34 20 0 20 C0 13.4 0 6.8 0 0 Z " fill="#457EF8" transform="translate(24,15)"></path>
<path d="M0 0 C2.31 0 4.62 0 7 0 C7 2.31 7 4.62 7 7 C4.69 7 2.38 7 0 7 C0 4.69 0 2.38 0 0 Z " fill="#2A59EF" transform="translate(0,11)"></path>
<path d="M0 0 C0.84454356 3.37817425 1.10844919 5.67465243 0 9 C-1.65 9.33 -3.3 9.66 -5 10 C-5.33 7.36 -5.66 4.72 -6 2 C-2.25 0 -2.25 0 0 0 Z " fill="#6343F6" transform="translate(21,29)"></path>
<path d="M0 0 C2.31 0 4.62 0 7 0 C7 1.98 7 3.96 7 6 C4.69 6 2.38 6 0 6 C0 4.02 0 2.04 0 0 Z " fill="#5B43F4" transform="translate(106,1)"></path>
<path d="M0 0 C1.65 0 3.3 0 5 0 C5 2.31 5 4.62 5 7 C3.35 7 1.7 7 0 7 C0 4.69 0 2.38 0 0 Z " fill="#464DF2" transform="translate(9,11)"></path>
<path d="M0 0 C0.66 0 1.32 0 2 0 C2 3.63 2 7.26 2 11 C1.01 11.495 1.01 11.495 0 12 C-1.17661508 8.32307787 -1.14475933 4.8361222 -1 1 C-0.67 0.67 -0.34 0.34 0 0 Z " fill="#05B8FA" transform="translate(21,19)"></path>
<path d="M0 0 C0.99 0 1.98 0 3 0 C3 2.31 3 4.62 3 7 C2.01 7 1.02 7 0 7 C0 4.69 0 2.38 0 0 Z " fill="#5944F4" transform="translate(14,11)"></path>
</svg>';
    }

    public function add_category_styles()
    {
?>
        <style>
            div#elementor-panel-category-plugincy button.elementor-panel-heading.elementor-panel-category-title span.elementor-panel-heading-title {
                display: flex;
                gap: 10px;
                align-items: center;
            }
            i.dashicons-onepaquc_one_page_cart::before {
                content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 24 24"><path d="m11.971 1.107 0.137 0c0.73 0.002 1.428 0.043 2.142 0.205l0.14 0.031C15.745 1.653 17.053 2.191 18.188 3l0.08 0.057c0.164 0.118 0.324 0.24 0.483 0.365l0.136 0.107A7.781 7.781 0 0 1 19.641 4.219l0.234 0.234 0.079 0.075c1.763 1.688 2.871 4.378 2.934 6.797 0.004 0.215 0.004 0.43 0.004 0.646l0 0.137c-0.002 0.73 -0.043 1.428 -0.205 2.142l-0.031 0.14C22.224 16.281 21.322 17.898 20.063 19.359l-0.092 0.11c-0.158 0.186 -0.324 0.35 -0.511 0.508a5.531 5.531 0 0 0 -0.196 0.176C18.594 20.783 17.825 21.276 17.016 21.703l-0.11 0.058C15.917 22.28 14.834 22.601 13.734 22.781l-0.154 0.026c-0.516 0.079 -1.027 0.086 -1.548 0.085l-0.138 0c-0.73 -0.002 -1.43 -0.043 -2.144 -0.205l-0.14 -0.031C7.719 22.224 6.102 21.322 4.641 20.063l-0.11 -0.092c-0.186 -0.158 -0.35 -0.324 -0.508 -0.511a5.531 5.531 0 0 0 -0.176 -0.196C3.217 18.594 2.724 17.825 2.297 17.016l-0.058 -0.11c-0.768 -1.466 -1.132 -3.111 -1.128 -4.758 0 -0.132 -0.001 -0.264 -0.002 -0.396 -0.003 -0.8 0.092 -1.579 0.286 -2.356l0.037 -0.149c0.439 -1.724 1.308 -3.336 2.535 -4.627 0.112 -0.117 0.112 -0.117 0.209 -0.243 0.081 -0.101 0.161 -0.18 0.26 -0.263 0.103 -0.087 0.204 -0.175 0.302 -0.268C5.407 3.216 6.175 2.724 6.984 2.297l0.11 -0.058c1.509 -0.791 3.184 -1.135 4.877 -1.131" fill="%236A3DF6"/><path d="m6.284 6.536 0.12 0.002c0.613 0.023 1.108 0.246 1.529 0.692 0.364 0.402 0.476 0.903 0.586 1.418l0.048 0.216A106.969 106.969 0 0 1 8.719 9.563l0.026 0.12q0.105 0.488 0.209 0.976c0.126 0.593 0.255 1.185 0.389 1.776q0.027 0.121 0.054 0.242c0.025 0.111 0.05 0.223 0.076 0.334l0.022 0.099c0.041 0.177 0.084 0.305 0.21 0.437 0.106 0.028 0.106 0.028 0.227 0.024l0.142 0.002 0.156 -0.001 0.164 0.001c0.179 0.001 0.359 0 0.538 0l0.373 0.001q0.392 0 0.783 -0.001c0.302 -0.001 0.603 -0.001 0.905 0q0.388 0.001 0.777 0 0.232 0 0.464 0c0.173 0 0.345 0 0.517 -0.001l0.155 0.001 0.142 -0.002 0.124 0c0.148 -0.032 0.203 -0.096 0.297 -0.211a4.828 4.828 0 0 0 0.158 -0.372l0.046 -0.119c0.112 -0.288 0.22 -0.578 0.329 -0.868l0.043 -0.113q0.106 -0.282 0.212 -0.565l0.081 -0.216 0.04 -0.106a10.781 10.781 0 0 1 0.351 -0.816c0.11 -0.24 0.137 -0.418 0.053 -0.67 -0.156 -0.064 -0.32 -0.053 -0.486 -0.053l-0.186 -0.001 -0.204 0 -0.215 0q-0.232 -0.001 -0.463 -0.001 -0.366 0 -0.732 -0.002l-0.251 -0.001 -0.127 0c-0.568 -0.002 -1.136 -0.004 -1.704 -0.004q-0.575 -0.001 -1.15 -0.003 -0.304 -0.002 -0.608 -0.001 -0.286 0 -0.572 -0.002a22.125 22.125 0 0 0 -0.21 0 20.719 20.719 0 0 1 -0.287 -0.001l-0.162 0c-0.175 -0.029 -0.253 -0.086 -0.377 -0.211 -0.053 -0.161 -0.053 -0.161 -0.047 -0.328 0.118 -0.151 0.189 -0.225 0.379 -0.264l0.165 0 0.092 -0.001c0.102 -0.001 0.204 0 0.305 0.001q0.11 0 0.22 -0.001c0.199 -0.001 0.397 -0.001 0.596 0 0.208 0.001 0.416 0 0.624 0 0.35 0 0.699 0 1.049 0.001a190.406 190.406 0 0 0 1.211 0q0.52 -0.002 1.041 -0.001c0.207 0 0.414 0 0.621 0q0.292 -0.001 0.585 0.001 0.107 0 0.214 0c0.452 -0.003 0.843 0.028 1.191 0.347 0.26 0.276 0.356 0.567 0.351 0.942 -0.031 0.255 -0.135 0.475 -0.241 0.707 -0.072 0.157 -0.14 0.315 -0.208 0.474l-0.044 0.101c-0.208 0.486 -0.382 0.985 -0.559 1.484 -0.466 1.304 -0.466 1.304 -0.934 1.555l-0.084 0.049c-0.123 0.053 -0.213 0.057 -0.347 0.058l-0.149 0.002 -0.163 0 -0.172 0.001q-0.234 0.002 -0.468 0.002 -0.146 0 -0.293 0.001 -0.459 0.002 -0.917 0.003 -0.528 0.001 -1.056 0.005a116.953 116.953 0 0 1 -0.818 0.003c-0.163 0 -0.325 0.001 -0.488 0.002 -0.182 0.002 -0.363 0.001 -0.545 0.001l-0.161 0.003c-0.363 -0.004 -0.616 -0.087 -0.9 -0.317 -0.272 -0.3 -0.354 -0.632 -0.435 -1.021l-0.04 -0.182q-0.044 -0.202 -0.087 -0.403a116.156 116.156 0 0 0 -0.154 -0.707 735.984 735.984 0 0 1 -0.259 -1.186q-0.075 -0.342 -0.148 -0.685a191.297 191.297 0 0 0 -0.147 -0.676q-0.028 -0.127 -0.055 -0.254a55.313 55.313 0 0 0 -0.077 -0.353c-0.011 -0.051 -0.011 -0.051 -0.022 -0.103 -0.079 -0.353 -0.213 -0.663 -0.498 -0.896 -0.226 -0.131 -0.442 -0.239 -0.707 -0.241l-0.111 -0.003a12.188 12.188 0 0 0 -0.231 -0.003c-0.281 -0.009 -0.281 -0.009 -0.428 -0.146 -0.086 -0.154 -0.101 -0.232 -0.069 -0.405 0.193 -0.26 0.357 -0.271 0.659 -0.261M15.469 15.047c0.323 0.252 0.565 0.581 0.656 0.984 0.04 0.484 -0.027 0.876 -0.328 1.266 -0.262 0.298 -0.611 0.536 -1.011 0.582 -0.499 0.012 -0.867 -0.056 -1.257 -0.398 -0.358 -0.375 -0.484 -0.723 -0.48 -1.24 0.021 -0.444 0.196 -0.776 0.521 -1.079 0.561 -0.454 1.278 -0.482 1.898 -0.114" fill="%23FCFBFE"/><path d="M11.238 15.09c0.323 0.27 0.592 0.627 0.633 1.06 0.012 0.48 -0.08 0.839 -0.392 1.211 -0.322 0.335 -0.701 0.503 -1.163 0.519 -0.446 0.004 -0.799 -0.157 -1.128 -0.46 -0.338 -0.371 -0.398 -0.768 -0.388 -1.256 0.03 -0.421 0.214 -0.745 0.528 -1.023 0.585 -0.42 1.302 -0.477 1.909 -0.051" fill="%23FDFBFE"/><path d="M10.654 15.604c0.233 0.133 0.354 0.273 0.455 0.521 0.037 0.292 -0.013 0.51 -0.188 0.75 -0.24 0.191 -0.436 0.251 -0.737 0.248 -0.224 -0.028 -0.353 -0.161 -0.497 -0.324 -0.17 -0.239 -0.17 -0.481 -0.126 -0.768 0.233 -0.41 0.636 -0.602 1.092 -0.428m4.214 -0.012c0.221 0.095 0.351 0.222 0.467 0.433 0.081 0.203 0.074 0.369 0.007 0.576 -0.099 0.226 -0.213 0.344 -0.436 0.462 -0.191 0.064 -0.363 0.071 -0.563 0.047 -0.233 -0.119 -0.398 -0.281 -0.516 -0.516 -0.025 -0.246 -0.031 -0.452 0.079 -0.677 0.284 -0.315 0.541 -0.443 0.961 -0.326"/></svg>');
            }
        </style>
<?php
    }

    public function init_category()
    {
        add_action('elementor/elements/categories_registered', [$this, 'add_category_with_priority'], 1);
    }

    public function add_category_with_priority($elements_manager)
    {
        // Force the category to be added at the beginning
        $elements_manager->add_category(
            'plugincy',
            [
                'title' => esc_html__('Plugincy', 'plugincy') . $this->get_svg_icon(),
                'icon' => 'plugincy-icon',
            ]
        );

        // Get all categories and reorder
        $categories = $elements_manager->get_categories();
        if (isset($categories['plugincy'])) {
            $plugincy_cat = $categories['plugincy'];
            unset($categories['plugincy']);

            // Insert at position 1 (after basic)
            $reordered = [];
            $index = 0;
            foreach ($categories as $key => $category) {
                if ($index === 1) {
                    $reordered['plugincy'] = $plugincy_cat;
                }
                $reordered[$key] = $category;
                $index++;
            }

            // If we didn't insert it (less than 2 categories), add it at the beginning
            if (!isset($reordered['plugincy'])) {
                $reordered = ['plugincy' => $plugincy_cat] + $reordered;
            }

            // Update the categories order
            $reflection = new ReflectionClass($elements_manager);
            $property = $reflection->getProperty('categories');
            $property->setAccessible(true);
            $property->setValue($elements_manager, $reordered);
        }
    }
}

// Use the alternative if the main one doesn't work
new Plugincy_Elementor_Category_Alternative();
